name: MyFXBook Data Scraper

on:
  schedule:
    # Bi·ªÉu th·ª©c cron cho "ch·∫°y m·ªói 5 ph√∫t"
    # C√∫ ph√°p: */5 nghƒ©a l√† t·∫°i ph√∫t 0, 5, 10, 15, ..., 55 c·ªßa m·ªói gi·ªù.
    - cron: '*/15 * * * *'
    #- cron: '1,6,11,16,21,26,31,36,41,46,51,56 * * * *'
  workflow_dispatch: # Cho ph√©p b·∫°n ch·∫°y th·ªß c√¥ng b·∫•t c·ª© l√∫c n√†o
  # üí° TH√äM PH·∫¶N N√ÄY V√ÄO FILE HI·ªÜN T·∫†I
  repository_dispatch:
    types: [cap_nhat_web] # ƒê·∫∑t t√™n s·ª± ki·ªán t√πy ch·ªânh (v√≠ d·ª•: cap_nhat_web)

jobs:
  run_scraper:
    # Ch·∫°y tr√™n m√¥i tr∆∞·ªùng Linux m·ªõi nh·∫•t
    runs-on: ubuntu-latest
    
    steps:
    - name: 1. Checkout Code
      # T·∫£i m√£ t·ª´ kho l∆∞u tr·ªØ v·ªÅ m√¥i tr∆∞·ªùng Runner
      uses: actions/checkout@v4

    - name: 2. Set up Python
      # Thi·∫øt l·∫≠p m√¥i tr∆∞·ªùng Python 3.10
      uses: actions:setup-python@v5
      with:
        python-version: '3.10'

    - name: 3. Install Dependencies
      # C√†i ƒë·∫∑t c√°c th∆∞ vi·ªán c·∫ßn thi·∫øt (requests v√† firebase-admin)
      run: |
        echo "requests" > requirements.txt
        echo "firebase-admin" >> requirements.txt
        echo "pytz" >> requirements.txt
        pip install -r requirements.txt

    - name: 4. Create Firebase Service Account File
      # S·ª≠ d·ª•ng Secret ƒë·ªÉ t·∫°o l·∫°i t·ªáp JSON c·∫ßn thi·∫øt trong runtime
      run: echo '${{ secrets.FIREBASE_SERVICE_ACCOUNT }}' > datafx-45432-firebase-adminsdk-fbsvc-3132a63c50.json

    - name: 5. Run Python Script
      # Ch·∫°y t·ªáp Python ch√≠nh
      run: python laysession.py
